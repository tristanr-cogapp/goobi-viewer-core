<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: imageView/imageView.zoomSlider.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: imageView/imageView.zoomSlider.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Module which handles the zoomslider functionality.
 * 
 * @requires jQuery
 */
var ImageView = ( function( imageView ) {
    'use strict';
    
    var _debug = false;
    var _zoomSlider = {};
    var _defaults = {
            /**
             * The position of the zoom-slider is "dilated" by a function d(zoom) =
             * 1/sliderDilation*tan[atan(sliderDilation)*zoom] This makes the slider
             * position change slower for small zoom and faster for larger zoom The
             * function is chosen so that d(0) = 0 and d(1) = 1
             */
            sliderDilation: 12
    };
    
    imageView.ZoomSlider = function(config, image)  {    
        this.config = $.extend( true, {}, _defaults );
        $.extend( true, this.config, config.global );
        this.image = image;
    }
    
    imageView.ZoomSlider.prototype.init = function() {
            if ( _debug ) {
                console.log( '##############################' );
                console.log( 'imageView.zoomSlider.init' );
                console.log( '##############################' );
            }
                this.addZoomSlider(this.config.zoomSlider );
                this.buttonToZoom(this.image.viewer.viewport.getHomeZoom());
                var zoom = this;
                    this.image.observables.viewerZoom.subscribe( function( event ) {
                        var scale = zoom.image.viewer.viewport.getZoom();
                        zoom.buttonToZoom( scale );
                    });
        };
        imageView.ZoomSlider.prototype.exists = function() {
            return this.$element.length &amp;&amp; this.$button.length;
        };
        imageView.ZoomSlider.prototype.buttonToMouse = function( mousePos ) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.buttonToMouse: mousePos - ' + mousePos );
            }
            
            var offset = this.$button.width() / 2;
            var newPos = mousePos - offset;
            if ( newPos &lt; 0 ) {
                newPos = 0;
            }
            if ( newPos + 2 * offset > this.absoluteWidth ) {
                newPos = this.absoluteWidth - 2 * offset;
            }

            this.$button.css( {
                left: newPos
            } );
            this.buttonPosition = newPos;
            var factor = ( newPos / ( this.absoluteWidth - offset * 2 ) );
            factor = 1 / this.config.sliderDilation * Math.tan( Math.atan( this.config.sliderDilation ) * factor );
            var newScale = this.image.viewer.viewport.getMinZoom() + ( this.image.viewer.viewport.getMaxZoom() - this.image.viewer.viewport.getMinZoom() ) * factor;
            
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.buttonToMouse: newScale - ' + newScale );
            }
            
            this.zoomTo( newScale );
        };
        imageView.ZoomSlider.prototype.zoomTo = function( zoomTo ) {
            if ( _debug ) {
                console.log( 'imageView.controls.myZoomTo: zoomTo - ' + zoomTo );
            }
            
            var zoomBy = parseFloat( zoomTo ) / this.image.viewer.viewport.getZoom();
            
            if ( _debug ) {
                console.log( 'imageView.controls.myZoomTo: zoomBy - ' + zoomBy );
            }
            
            this.image.viewer.viewport.zoomBy( zoomBy, this.image.viewer.viewport.getCenter( false ), true );
            this.setLabel(zoomTo);
        };
        imageView.ZoomSlider.prototype.buttonToZoom = function( scale ) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.buttonToZoom: scale - ' + scale );
                console.log( 'imageView.zoomSlider.buttonToZoom: _zoomSlider - ', _zoomSlider );
            }
            
            if ( !this.image.viewer.viewport ) {
                return;
            }

            if(this.$button) { 
                var factor = ( scale - this.image.viewer.viewport.getMinZoom() ) / ( this.image.viewer.viewport.getMaxZoom() - this.image.viewer.viewport.getMinZoom() );
                
                factor = 1 / Math.atan( this.config.sliderDilation ) * Math.atan( this.config.sliderDilation * factor );
                var newPos = factor * ( this.absoluteWidth - this.$button.width() );
                
                
                if ( Math.abs( this.image.viewer.viewport.getMaxZoom() - scale ) &lt; 0.0000000001 ) {
                    newPos = this.absoluteWidth - this.$button.width();
                }
                
                if ( newPos &lt; 0 ) {
                    newPos = 0;
                }
                
                this.$button.css( {
                    left: newPos
                } );
                this.buttonPosition = newPos;
            }
            this.setLabel(scale);
        },
        imageView.ZoomSlider.prototype.setLabel = function(scale) {
            if(this.$label.length &amp;&amp; this.image.sizes) {
                var imageWidth = this.image.config.image.originalImageWidth;
                var imageViewWidth = this.image.container.width();
                scale = parseFloat(scale)/imageWidth*imageViewWidth;
                this.$label.val((scale*100).toFixed(1));
            }
        };
        imageView.ZoomSlider.prototype.inputToZoom = function(input) {
            var imageScale = parseFloat(input);
            if(imageScale &amp;&amp; this.image.sizes) {
                if(_debug) {
                    console.log("scale to ", input);
                }
                var imageWidth = this.image.config.image.originalImageWidth;
                var imageViewWidth = this.image.container.width();
                var scale = imageScale*imageWidth/imageViewWidth/100.0;
                if(scale &lt; this.image.viewer.viewport.getMinZoom()) {
                    scale = this.image.viewer.viewport.getMinZoom();
                } else if(scale > this.image.viewer.viewport.getMaxZoom()) {
                    scale = this.image.viewer.viewport.getMaxZoom();
                }
                this.zoomTo( scale );
            }
        };
        imageView.ZoomSlider.prototype.addZoomSlider = function( element ) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.addZoomSlider: element - ' + element );
            }
            
            this.buttonPosition = 0;
            this.$element = $( element );
            this.absoluteWidth = this.$element.innerWidth();
            this.mousedown = false;
            var slider = this;
            if(this.$element.length) {
                this.$button = this.$element.children( this.config.zoomSliderHandle );
                this.$element.on('mousedown', function(event) {
                    _zoomSliderMouseDown(event, slider);
                });
                this.$element.on('mousemove', function(event) {
                    _zoomSliderMouseMove(event, slider);
                });
                if(this.$button.length) {
                    this.$button.on( 'mousedown', function(event) {
                        _buttonMouseDown(event, slider);                    
                    });
                }
            }
            this.$label = $(this.config.zoomSliderLabel);
            if(this.$label.length) {
                this.$label.on("change", function(event) {
                    slider.inputToZoom(event.target.value)
                    return false;
                });
                this.$label.on("keypress", function(e) {
                    if (e.which == 13) {
                        slider.inputToZoom(e.target.value)
                        return false;
                    }
                });
            }
            $( document ).on( 'mouseup', function(event) {
                _zoomSliderMouseUp(event, slider);
            });
        };
        
        function _zoomSliderMouseUp(event, slider) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.zoomSliderMouseUp' );
            }
            
            slider.mousedown = false;
        };
        function _zoomSliderMouseMove(event, slider) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.zoomSliderMouseMove: evt - ' + event );
            }
            
            if ( !slider.mousedown ) {
                return;
            }
            var offset = slider.$element.offset();
            var hitX = event.pageX - offset.left;
            slider.buttonToMouse( hitX );
            
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.zoomSliderMouseMove: moving - ' + hitX );
            }
        };
        function _zoomSliderMouseDown(event, slider) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.zoomSliderMouseDown: evt - ' + event );
            }
            
            slider.mousedown = true;
            var offset = slider.$element.offset();
            var hitX = event.pageX - offset.left;
            slider.buttonToMouse( hitX );
        };
        function _buttonMouseDown(event, slider) {
            if ( _debug ) {
                console.log( 'imageView.zoomSlider.buttonMouseDown' );
            }
            
            slider.mousedown = true;
            
            return false;
        };
    
    return imageView;
    
} )( ImageView );
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="cmsJS.module_createPage.html">createPage</a></li><li><a href="cmsJS.module_geoLocations.html">geoLocations</a></li><li><a href="cmsJS.module_masonry.html">masonry</a></li><li><a href="cmsJS.module_rssFeed.html">rssFeed</a></li><li><a href="cmsJS.module_sortableList.html">sortableList</a></li><li><a href="cmsJS.module_stackedCollection.html">stackedCollection</a></li><li><a href="cmsJS.module_staticGrid.html">staticGrid</a></li><li><a href="cmsJS.module_tagList.html">tagList</a></li><li><a href="cmsJS.module_tileGrid.html">tileGrid</a></li><li><a href="module-cmsJS.html">cmsJS</a></li><li><a href="module-viewerJS.html">viewerJS</a></li><li><a href="viewerJS.module_bookshelvesSession.html">bookshelvesSession</a></li><li><a href="viewerJS.module_bookshelvesUser.html">bookshelvesUser</a></li><li><a href="viewerJS.module_calendarPopover.html">calendarPopover</a></li><li><a href="viewerJS.module_changeFontSize.html">changeFontSize</a></li><li><a href="viewerJS.module_chronoSlider.html">chronoSlider</a></li><li><a href="viewerJS.module_clipboard.html">clipboard</a></li><li><a href="viewerJS.module_dataTable.html">dataTable</a></li><li><a href="viewerJS.module_dateSortedFeed.html">dateSortedFeed</a></li><li><a href="viewerJS.module_download.html">download</a></li><li><a href="viewerJS.module_downloadModal.html">downloadModal</a></li><li><a href="viewerJS.module_helper.html">helper</a></li><li><a href="viewerJS.module_mirador.html">mirador</a></li><li><a href="viewerJS.module_navigation.html">navigation</a></li><li><a href="viewerJS.module_nerFacetting.html">nerFacetting</a></li><li><a href="viewerJS.module_nerFulltext.html">nerFulltext</a></li><li><a href="viewerJS.module_normdata.html">normdata</a></li><li><a href="viewerJS.module_pageScroll.html">pageScroll</a></li><li><a href="viewerJS.module_paginator.html">paginator</a></li><li><a href="viewerJS.module_responsiveColumnGallery.html">responsiveColumnGallery</a></li><li><a href="viewerJS.module_searchAdvanced.html">searchAdvanced</a></li><li><a href="viewerJS.module_searchList.html">searchList</a></li><li><a href="viewerJS.module_searchSortingDropdown.html">searchSortingDropdown</a></li><li><a href="viewerJS.module_simpleLightbox.html">simpleLightbox</a></li><li><a href="viewerJS.module_stackedThumbnails.html">stackedThumbnails</a></li><li><a href="viewerJS.module_thumbnails.html">thumbnails</a></li><li><a href="viewerJS.module_timematrix.html">timematrix</a></li><li><a href="viewerJS.module_tinyMce.html">tinyMce</a></li><li><a href="viewerJS.module_userComments.html">userComments</a></li><li><a href="viewerJS.module_userDropdown.html">userDropdown</a></li><li><a href="viewerJS.module_versionHistory.html">versionHistory</a></li><li><a href="viewImage.controls.module_persistence.html">persistence</a></li><li><a href="viewImage.module_controls.html">controls</a></li><li><a href="viewImage.module_drawRect.html">drawRect</a></li><li><a href="viewImage.module_Measures.html">Measures</a></li><li><a href="viewImage.module_overlays.html">overlays</a></li><li><a href="viewImage.module_readingMode.html">readingMode</a></li><li><a href="viewImage.module_tileSourceResolver.html">tileSourceResolver</a></li><li><a href="viewImage.module_transformRect.html">transformRect</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ImageView">ImageView</a></li><li><a href="global.html#Statistics">Statistics</a></li><li><a href="global.html#WorldGenerator">WorldGenerator</a></li><li><a href="global.html#X3DLoader">X3DLoader</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Dec 12 2018 08:43:05 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
