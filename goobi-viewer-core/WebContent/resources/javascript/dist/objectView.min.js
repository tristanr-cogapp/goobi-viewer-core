/*!
 * This file is part of the Goobi viewer - a content presentation and management application for digitized objects.
 *
 * Visit these websites for more information.
 * - http://www.intranda.com
 * - http://digiverso.com
 *
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program. If not, see <http://www.gnu.org/licenses/>.
 */
THREE.FBXMeshLoader=function(e,t){this.color=t,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.FBXMeshLoader.prototype={constructor:THREE.FBXMeshLoader,load:function(e,o,t,i){var n=new THREE.FBXLoader(this.manager);this.color;Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);e.uri.substring(0,e.uri.lastIndexOf("/"));var t=e.uri;n.load(t,function(e){console.log("loaded mesh ",e),o(e)},function(e){console.log("loading ",e)},function(e){console.log("error ",e)})})}},THREE.GLTFDRACOLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.GLTFDRACOLoader.prototype={constructor:THREE.GLTFDRACOLoader,load:function(e,o,t,i){var n=new THREE.GLTFLoader(this.manager);THREE.DRACOLoader.setDecoderPath("/../three/dependencies/draco"),n.setDRACOLoader(new THREE.DRACOLoader),Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);e.uri.substring(0,e.uri.lastIndexOf("/"));var t=e.uri;n.load(t,function(e){console.log("loaded gltf ",e),o(e.scene)},function(e){console.log("loading ",e)},function(e){console.log("error ",e)})})}},THREE.OBJMTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(e,a,r,s){Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);e.uri.substring(0,e.uri.lastIndexOf("/"));var t=e.uri,o=e.resources.filter(function(e){return e.endsWith(".mtl")}).shift(),i=new THREE.MTLLoader(this.manager),n=new THREE.OBJLoader(this.manager);i.setTexturePath(o.substring(0,o.lastIndexOf("/"))+"/");i.load(o,function(e){e.preload(),n.setMaterials(e),n.load(t,a,r,s)},r,s)})}},THREE.PLYMeshLoader=function(e,t){this.color=t,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.PLYMeshLoader.prototype={constructor:THREE.PLYMeshLoader,load:function(e,i,o,n){var a=new THREE.PLYLoader(this.manager),r=this.color;Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);e.uri.substring(0,e.uri.lastIndexOf("/"));var t=e.uri;a.load(t,function(e){e.computeVertexNormals();var t=new THREE.MeshStandardMaterial({color:r,shading:THREE.FlatShading}),o=new THREE.Mesh(e,t);o.castShadow=!0,o.receiveShadow=!0,i(o)},o,n)})}},THREE.STLMeshLoader=function(e,t){this.color=t,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.STLMeshLoader.prototype={constructor:THREE.STLMeshLoader,load:function(e,i,o,n){var a=new THREE.STLLoader(this.manager),r=this.color;Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);e.uri.substring(0,e.uri.lastIndexOf("/"));var t=e.uri;console.log("loader ",a),a.load(t,function(e){e.computeVertexNormals();var t=new THREE.MeshStandardMaterial({color:r,shading:THREE.FlatShading}),o=new THREE.Mesh(e,t);o.castShadow=!0,o.receiveShadow=!0,i(o)},o,n)}).catch(function(e){n(e)})}},THREE.TDSMeshLoader=function(e,t){this.color=t,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TDSMeshLoader.prototype={constructor:THREE.TDSMeshLoader,load:function(e,n,o,a){var r=new THREE.TDSLoader(this.manager),s=new THREE.TextureLoader;Q($.getJSON(e)).then(function(e){console.log("loading object info = ",e);var t=e.uri,i=e.resources.filter(function(e){return e.match(/je?pg|png$/i)});r.load(t,function(e){console.log("LOADING 3DS OBJECT",e),e instanceof THREE.Mesh&&console.log("object is already a mesh");var o=i.map(function(e){return s.load(e)});console.log("loaded textures ",o),e.traverse(function(e){if(e instanceof THREE.Mesh){var t=o.shift();e.material.map=t}}),e.castShadow=!0,e.receiveShadow=!0,n(e)},o,a)})}},X3DLoader=function(){},X3DLoader.prototype={constructor:X3DLoader,load:function(o,e,i,t,n){return Q($.getJSON(e)).then(function(e){console.log("Loading x3dom ",e);var t='<x3d width="'+(o.width()+"px")+'" height="'+(o.height()+"px")+'"><scene><inline url="'+e.uri+'"></inline></scene></x3d>';o.get(0).innerHTML+=t,x3dom.reload(),i()})}};var WorldGenerator=function(){var o={camera:{fieldOfView:35,viewPadding:0,nearPlane:.1,farPlane:1e4,position:{x:0,y:0,z:0},offset:{x:0,y:0,z:0}},container:{id:"container"},light:{background:{color:16777215},ambient:{color:9474192,intensity:.7},directional:[{color:11184810,intensity:.7,position:{x:0,y:10,z:0},castShadow:!0,showHelper:!1},{color:11184810,intensity:.7,position:{x:0,y:-10,z:0},castShadow:!0,showHelper:!1},{color:11184810,intensity:.7,position:{x:-10,y:0,z:0},castShadow:!0,showHelper:!1},{color:11184810,intensity:.7,position:{x:10,y:0,z:0},castShadow:!0,showHelper:!1}]}},l=function(e,t){return{x:void 0===t.x?180*e._x/Math.PI:180*e._x/Math.PI+t.x,y:void 0===t.y?180*e._y/Math.PI:180*e._y/Math.PI+t.y,z:void 0===t.z?180*e._z/Math.PI:180*e._z/Math.PI+t.z}},a=function(e,t,o,i){i||(i={x:0,y:0,z:0});var n=t/180*Math.PI,a={x:e.x-i.x,y:e.y-i.y,z:e.z-i.z},r={x:a.x,y:a.y,z:a.z};switch(o){case"x":r.y=a.y*Math.cos(n)-a.z*Math.sin(n),r.z=a.y*Math.sin(n)+a.z*Math.cos(n);break;case"y":r.x=a.x*Math.cos(n)-a.z*Math.sin(n),r.z=a.x*Math.sin(n)+a.z*Math.cos(n);break;case"z":r.x=a.x*Math.cos(n)-a.y*Math.sin(n),r.y=a.x*Math.sin(n)+a.y*Math.cos(n);break;default:throw"Third parameter 'axis' must be one of 'x', 'y' or 'z'"}return{x:r.x+i.x,y:r.y+i.y,z:r.z+i.z}},e={create:function(e){var t={};return $.extend(!0,t,o),$.extend(!0,t,e),new i(t)}},i=function(e){if(console.log("Constructing world with config ",e),this.config=e,this.time=0,this.container=document.getElementById(e.container.id),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(e.camera.fieldOfView,this.container.clientWidth/this.container.clientHeight,e.camera.nearPlane,e.camera.farPlane),this.camera.position.set(e.camera.position.x,e.camera.position.y,e.camera.position.z),this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(e.light.background.color),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.container.appendChild(this.renderer.domElement),this.controls=new THREE.OrbitControls(this.camera,this.container),this.loadingManager=new THREE.LoadingManager,this.loadingManager.onProgress=function(e,t,o){console.log("Progress on load ",e,t,o)},this.directionalLights=[],e.light.ambient){var t=new THREE.AmbientLight(e.light.ambient.color,e.light.ambient.intensity);this.scene.add(t),this.ambientLight=t}if(e.light.directional){var o=e.light.directional;$.isArray(o)||(o=[o]);for(var i=0;i<o.length;i++){var n=o[i];t=this.createShadowedLight(n.position,n.color,n.intensity,(a=n.position,Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)),n.castShadow,n.showHelper);this.directionalLights.push(t),this.scene.add(t)}}var a;this.tick=new Rx.Subject};return i.prototype.initControls=function(t,e,o){var i=this;if(e.xAxis){var n=$(e.xAxis.rotateLeft);0<n.length&&n.on("click",function(e){i.rotate(t,l(t.rotation,{x:-90})),i.center(t,t.position)});var a=$(e.xAxis.rotateRight);0<a.length&&a.on("click",function(e){i.rotate(t,l(t.rotation,{x:90})),i.center(t,t.position)})}if(e.yAxis){var r=$(e.yAxis.rotateLeft);0<r.length&&r.on("click",function(e){i.rotate(t,l(t.rotation,{y:-90})),i.center(t,t.position)});var s=$(e.yAxis.rotateRight);0<s.length&&s.on("click",function(e){i.rotate(t,l(t.rotation,{y:90})),i.center(t,t.position)})}if(e.zAxis){var c=$(e.zAxis.rotateLeft);0<c.length&&c.on("click",function(e){i.rotate(t,l(t.rotation,{z:-90})),i.center(t,t.position)});var h=$(e.zAxis.rotateRight);0<h.length&&h.on("click",function(e){i.rotate(t,l(t.rotation,{z:90})),i.center(t,t.position)})}if(e.position){var d=$(e.position.reset);0<d.length&&d.on("click",function(e){i.controls.reset()})}},i.prototype.rotateLights=function(e,t){for(var o in this.directionalLights){var i=this.directionalLights[o],n=a(i.position,e,t);i.position.x=n.x,i.position.y=n.y,i.position.z=n.z}},i.prototype.addSphere=function(t){var e=new THREE.SphereGeometry(t.size/2,64,64),o=new THREE.MeshLambertMaterial({color:t.material.color,transparent:!!t.material.opacity,opacity:t.material.opacity}),i=new THREE.Mesh(e,o);this.center(i,t.position),t.focus&&this.zoomToObject(i,this.config.camera.viewPadding,this.config.camera.fieldOfView),t.onTick&&this.tick.subscribe(function(e){t.onTick(i,e)}),this.scene.add(i)},i.prototype.addBlock=function(t){var e=new THREE.BoxGeometry(t.box.max.x-t.box.min.x,t.box.max.y-t.box.min.y,t.box.max.z-t.box.min.z),o=new THREE.MeshLambertMaterial({color:t.material.color,transparent:!!t.material.opacity,opacity:t.material.opacity}),i=new THREE.Mesh(e,o);this.center(i,t.position),t.focus&&this.zoomToObject(i,this.config.camera.viewPadding,this.config.camera.fieldOfView),t.onTick&&this.tick.subscribe(function(e){t.onTick(i,e)}),this.scene.add(i)},i.prototype.addPlane=function(t){var e=new THREE.PlaneGeometry(t.size,t.size),o=new THREE.MeshLambertMaterial({color:t.material.color,transparent:!!t.material.opacity,opacity:t.material.opacity}),i=new THREE.Mesh(e,o);i.receiveShadow=!0,i.position.set(t.offset.x,t.offset.y,t.offset.z),i.rotation.set(t.rotation.x*Math.PI/180,t.rotation.y*Math.PI/180,t.rotation.z*Math.PI/180),t.onTick&&this.tick.subscribe(function(e){t.onTick(i,e)}),this.scene.add(i)},i.prototype.loadObject=function(t){console.log("Load object ",t);var e=function(e,t){e.url;var o=e.url.replace("/info.json",""),i=o.substring(o.lastIndexOf(".")+1);switch(i.toLowerCase()){case"obj":return new THREE.OBJMTLLoader(t);case"ply":return new THREE.PLYMeshLoader(t,e.material.color);case"stl":return new THREE.STLMeshLoader(t,e.material.color);case"fbx":return new THREE.FBXMeshLoader(t,e.material.color);case"3ds":return new THREE.TDSMeshLoader(t);case"gltf":return new THREE.GLTFDRACOLoader(t);default:console.log("no loader defined for "+i)}}(t,this.loadingManager),o=this,i=Q.defer();return e&&e.load(t.url,function(e){o.addObject(e,t),i.resolve(e)},function(){},function(e){i.reject(e)}),i.promise},i.prototype.addObject=function(t,o){return this.setSize(t,o.size),this.rotate(t,o.rotation),this.center(t,o.position),this.initControls(t,this.config.controls,o),o.focus&&this.zoomToObject(t,this.config.camera.viewPadding,this.config.camera.fieldOfView),o.onTick&&this.tick.subscribe(function(e){o.onTick(t,e)}),this.scene.add(t),this.controls.saveState(),this.object=t},i.prototype.rotate=function(e,t){console.log("rotate object by ",t),e.rotation.set(t.x*Math.PI/180,t.y*Math.PI/180,t.z*Math.PI/180)},i.prototype.center=function(e,t){var o=this.getBoundingSphere(e).center;e.position.set(t.x-o.x,t.y-o.y,t.z-o.z)},i.prototype.setSize=function(e,t){var o=t/this.getBoundingSphere(e).radius;e.scale.set(o,o,o)},i.prototype.getBoundingSphere=function(e){var t;e.geometry&&e.geometry.computeBoundingSphere?(e.geometry.boundingSphere||e.geometry.computeBoundingSphere(),(t=e.geometry.boundingSphere).radius*=e.scale.x):t=(new THREE.Box3).setFromObject(e).getBoundingSphere();return{center:t.center,radius:t.radius}},i.prototype.zoomToObject=function(e,t,o){var i=this.getBoundingSphere(e);this.zoomToPosition(i.center,2*i.radius+t,o)},i.prototype.zoomToPosition=function(e,t,o){var i=t/(2*Math.sin(Math.PI/180*o/2));this.camera.position.set(e.x,e.y,e.z+i)},i.prototype.createShadowedLight=function(e,t,o,i,n,a){var r=new THREE.DirectionalLight(t,o);if(r.position.set(e.x,e.y,e.z),this.scene.add(r),r.castShadow=n,r.shadow.camera.left=-i,r.shadow.camera.right=i,r.shadow.camera.top=i,r.shadow.camera.bottom=-i,r.shadow.camera.near=i/10,r.shadow.camera.far=10*i,r.shadow.mapSize.width=1024,r.shadow.mapSize.height=1024,r.shadow.bias=-.005,a){var s=new THREE.DirectionalLightHelper(r,i/10);this.scene.add(s)}return r},i.prototype.render=function(){if(!this.disposed){this.time+=1,this.renderer.render(this.scene,this.camera),this.tick.onNext(this.time);var e=this;window.requestAnimationFrame(function(){e.render()})}},i.prototype.dispose=function(){this.disposeObject(this.object),this.disposed=!0},i.prototype.disposeObject=function(e){for(var t in e.children)this.disposeObject(e.children[t]);e.geometry&&(e.geometry.dispose&&e.geometry.dispose(),e.geometry=void 0),e.material&&(e.material.map&&(e.material.map.dispose&&e.material.map.dispose(),e.material.map=void 0),e.material.dispose&&e.material.dispose(),e.material=void 0)},e}();
//# sourceMappingURL=objectView.min.js.map