<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components">
    
    <composite:interface />

    <composite:implementation>
        <ui:fragment rendered="#{configurationBean.displayWidgetUsage}">
            <div id="widgetUsage" class="widget widget-usage">
                <h3>#{msg.widgetUsage}</h3>

                <!-- LICENSE TEXT -->
                <p id="licenseText" class="widget-usage__license-text">
                    <viewerComponent:metadata metadata="#{activeDocumentBean.viewManager.usageWidgetAccessCondition}" displayLabel="false" />
                </p>

                <!-- WORK -->
                <h4 id="titleWork" class="widget-usage__subtitle">#{msg.Werk}</h4>
                
                <!-- WORK DOWNLOADS -->
                <div class="widget-usage__work-downloads">
                    <!-- METS/LIDO -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'METS'}">
                        <a 
                            href="#{activeDocumentBean.viewManager.metsResolverUrl}"
                            id="lidomets" 
                            class="label label-default widget-usage__work-download-lido-mets" 
                            title="#{msg.metadata_dl_mets}" 
                            target="_blank"> 
                            #{msg.downloadMetsButtonLabel}
                        </a>
                    </ui:fragment>
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'LIDO'}">
                        <a 
                            href="#{activeDocumentBean.viewManager.lidoResolverUrl}"
                            id="lidomets" 
                            class="label label-default widget-usage__work-download-lido-mets" 
                            title="#{msg.metadata_dl_lido}" 
                            target="_blank"> 
                            #{msg.downloadLidoButtonLabel}
                        </a>
                    </ui:fragment>
    
                    <!-- ALTO (WORK) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForWork}">
                        <a 
                            href="#{activeDocumentBean.viewManager.altoUrlForAllPages}"
                            id="alto" 
                            class="label label-default widget-usage__work-download-alto" 
                            title="#{msg.metadata_dl_alto_work}"
                            target="_blank"> 
                            #{msg.downloadAltoWorkButtonLabel}
                        </a>
                    </ui:fragment>
    
                    <!-- FULLTEXT (WORK) -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.belowFulltextThreshold}">
                        <a 
                            href="#{activeDocumentBean.viewManager.fulltextUrlForAllPages}"
                            id="textWork" 
                            class="label label-default widget-usage__work-download-fulltext" 
                            title="#{msg.downloadWorkFulltext}"
                            target="_blank">
                            #{msg.FULLEXT}
                        </a>
                    </ui:fragment>
    
                    <!-- PDF (WORK) -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.filesOnly and activeDocumentBean.viewManager.hasPages and activeDocumentBean.accessPermissionPdf}">
                        <ui:fragment rendered="#{!configurationBean.generatePdfInTaskManager}">
                            <a 
                                href="#{activeDocumentBean.viewManager.pdfDownloadLink}" 
                                id="pdfWork" 
                                class="label label-default widget-usage__work-download-pdf" 
                                title="#{msg.metadata_dl_pdf}" 
                                target="_blank">
                                #{msg.pdfDownload}</a>
                        </ui:fragment>
                        <ui:fragment rendered="#{configurationBean.generatePdfInTaskManager}">
                            <a 
                                href="#" 
                                id="pdfWork" 
                                class="label label-default widget-usage__work-download-pdf download-modal-widget" 
                                data-type="pdf" 
                                data-title="#{activeDocumentBean.titleBarLabel}" 
                                data-id=""
                                data-pi="#{activeDocumentBean.viewManager.pi}" 
                                title="#{msg.pdfDownload}">
                                #{msg.pdfDownload}
                            </a>    
                        </ui:fragment>
                    </ui:fragment>
    
                    <!-- EPUB -->
                    <ui:fragment rendered="#{activeDocumentBean.accessPermissionEpub}">
                        <a 
                            href="#" 
                            class="label label-default widget-usage__work-download-epub download-modal-widget" 
                            data-type="epub" 
                            data-title="#{activeDocumentBean.titleBarLabel}" 
                            data-id=""
                            data-pi="#{activeDocumentBean.viewManager.pi}" 
                            title="#{msg.epubDownload}">
                            #{msg.epub}
                        </a>
                    </ui:fragment>
    
                    <!-- IIIF MANIFEST -->
                    <a 
                        id="iiifManifest" 
                        class="label label-default widget-usage__work-download-iiif" 
                        data-copy="iiif-manifest" 
                        data-clipboard-text="#{imageDelivery.iiifManifest}" 
                        data-copy-done="#{msg.iiif_CopyUrlDone}"
                        title="#{msg.iiif_copyUrl}"> 
                        #{msg.iiif}
                    </a>
                </div>
                    
                <!-- PAGE -->
                <h4 id="titlePage" class="widget-usage__subtitle">#{msg.page}</h4>
                
                <!-- PAGE DOWNLOADS -->
                <div class="widget-usage__page-downloads">
                    <!-- ALTO (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForPage}">
                        <a 
                            href="#{activeDocumentBean.viewManager.altoUrl}"
                            id="altoPage" 
                            class="label label-default widget-usage__page-download-alto" 
                            title="#{msg.metadata_dl_alto_page}" 
                            target="_blank">
                            #{msg.downloadAltoPageButtonLabel}
                        </a>
                    </ui:fragment>
    
                    <!-- FULLTEXT (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextAvailableForPage}">
                        <a 
                            href="#{activeDocumentBean.viewManager.fulltextUrl}"
                            id="textPage" 
                            class="label label-default widget-usage__page-download-fulltext" 
                            title="#{msg.downloadPageFulltext}" 
                            target="_blank">
                            #{msg.FULLEXT}
                        </a>
                    </ui:fragment>
    
                    <!-- PDF (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessPermissionPdf}">
                        <a 
                            href="#{activeDocumentBean.viewManager.pdfPageDownloadLink}" 
                            id="pdfPage" 
                            class="label label-default widget-usage__page-download-pdf" 
                            title="#{msg.pdfDownloadCurrentPage}" 
                            target="_blank">
                            #{msg.pdfDownload}
                        </a>
                    </ui:fragment>
    
                    <!-- JPEG -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessForJs}">
                        <a 
                            href="#{activeDocumentBean.viewManager.currentImageUrl}"
                            id="jpeg" 
                            class="label label-default widget-usage__page-download-jpeg" 
                            title="#{msg.imageLinkDesc}" 
                            target="_blank">
                            #{msg.imageLink}
                        </a>
                    </ui:fragment>
                </div>
            </div>
            
            <script>
            	var downloadModalConfig = {
                    downloadBtn: $( ".download-modal-widget" ),
                    path: "#{navigationHelper.applicationUrl}",
                    iiifPath: "#{configurationBean.iiifApiUrl}",
                    userEmail: $( "#userEmail" ).val(),
                    useReCaptcha: #{configurationBean.useReCaptcha},
                    reCaptchaSiteKey: "#{configurationBean.reCaptchaSiteKey}",
                    messages: {
                        downloadInfo: {
                            text: "#{msg.downloadInfoText}",
                            title: "#{msg.downloadInfoTitle}",
                            part: "#{msg.downloadInfoPart}",
                            fileSize: "#{msg.downloadInfoFileSize}"
                        },
                        reCaptchaText: "#{msg.downloadReCaptchaText}",
                        rcInvalid: "#{msg.downloadRcInvalid}",
                        rcValid: "#{msg.downloadRcValid}",
                        eMailText: "#{msg.downloadEMailText}",
                        eMailTextLoggedIn: "#{msg.downloadEMailTextLoggedIn}",
                        eMail: "#{msg.downloadEmail}",
                        closeBtn: "#{msg.downloadCloseModal}",
                        saveBtn: "#{msg.downloadGenerateFile}",
                    }
                };
                
                viewerJS.downloadModal.init( downloadModalConfig );
                viewerJS.clipboard.init();
            </script>    
        </ui:fragment>
    </composite:implementation>
</ui:composition>
