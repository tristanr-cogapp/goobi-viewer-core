<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components">
    <composite:interface />

    <composite:implementation>
        <ui:fragment rendered="#{configurationBean.displayWidgetUsage}">
            <!--             <div class="view-object__sidebar-accordeon-panel"> -->
            <!--                 <h3 class="view-object__sidebar-accordeon-panel-title">#{msg.usage}</h3> -->
            <!--             </div> -->

            <div class="view-object__sidebar-accordeon-panel-body">
                <div
                    id="widgetUsage"
                    class="widget widget-usage">
                    <h3>#{msg.usage}</h3>

                    <p
                        id="licenseText"
                        class="widget-usage__license-text">
                        <viewerComponent:metadata
                            metadata="#{activeDocumentBean.viewManager.usageWidgetAccessCondition}"
                            displayLabel="false" />
                    </p>


                    <h4
                        id="titleWork"
                        class="widget-usage__subtitle">#{msg.Werk}</h4>

                    <!-- METS/LIDO -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'METS'}">
                        <a
                            id="lidomets"
                            class="label label-default"
                            title="#{msg.metadata_dl_mets}"
                            target="_blank"
                            href="#{activeDocumentBean.viewManager.metsResolverUrl}"> #{msg.downloadMetsButtonLabel} </a>
                    </ui:fragment>
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'LIDO'}">
                        <a
                            id="lidomets"
                            class="label label-default"
                            title="#{msg.metadata_dl_lido}"
                            target="_blank"
                            href="#{activeDocumentBean.viewManager.lidoResolverUrl}"> #{msg.downloadLidoButtonLabel} </a>
                    </ui:fragment>

                    <!-- ALTO (WORK) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForWork}">
                        <a
                            id="alto"
                            class="label label-default"
                            title="#{msg.metadata_dl_alto_work}"
                            href="#{activeDocumentBean.viewManager.altoUrlForAllPages}"> #{msg.downloadAltoWorkButtonLabel} </a>
                    </ui:fragment>
                    
                    <!-- FULLTEXT (WORK) -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.belowFulltextThreshold}">
                        <a
                            id="textWork"
                            class="label label-default"
                            title="#{msg.downloadWorkFulltext}"
                            href="#{activeDocumentBean.viewManager.fulltextUrlForAllPages}"> #{msg.FULLEXT} </a>
                    </ui:fragment>
                    

                    <!-- PDF (WORK) -->
                    <ui:fragment
                        rendered="#{!activeDocumentBean.viewManager.filesOnly and activeDocumentBean.viewManager.hasPages and activeDocumentBean.accessPermissionPdf}">
                        <ui:fragment rendered="#{!configurationBean.generatePdfInTaskManager}">
                            <a
                                id="pdfWork"
                                class="label label-default"
                                href="#{activeDocumentBean.viewManager.pdfDownloadLink}"
                                title="#{msg.metadata_dl_pdf}"
                                target="_blank"> #{msg.pdfDownload}</a>
                        </ui:fragment>
                        <ui:fragment rendered="#{configurationBean.generatePdfInTaskManager}">
                            <a
                                id="pdfWork"
                                class="label label-default download-modal-widget"
                                href="#"
                                data-type="pdf"
                                data-title="#{activeDocumentBean.titleBarLabel}"
                                data-id=""
                                data-pi="#{activeDocumentBean.viewManager.pi}"
                                title="#{msg.pdfDownload}"> #{msg.pdfDownload}</a>

                        </ui:fragment>
                    </ui:fragment>

                    <!-- EPUB -->
                    <ui:fragment rendered="#{activeDocumentBean.accessPermissionEpub}">
                        <a
                            href="#"
                            class="label label-default download-modal-widget"
                            data-type="epub"
                            data-title="#{activeDocumentBean.titleBarLabel}"
                            data-id=""
                            data-pi="#{activeDocumentBean.viewManager.pi}"
                            title="#{msg.epubDownload}"> #{msg.epub} </a>
                    </ui:fragment>


                    <!-- IIIF MANIFEST -->
                    <a
                        id="iiifManifest"
                        class="label label-default"
                        data-copy="iiif-manifest"
                        data-clipboard-text="#{imageDelivery.iiifManifest}"
                        title="#{msg.iiif_copyUrl}"> #{msg.iiif} </a>
                    <h4
                        id="titlePage"
                        class="widget_usage__subtitle">#{msg.page}</h4>

                    <!-- ALTO (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForPage}">
                        <a
                            id="altoPage"
                            class="label label-default"
                            title="#{msg.metadata_dl_alto_page}"
                            target="_blank"
                            href="#{activeDocumentBean.viewManager.altoUrl}"> #{msg.downloadAltoPageButtonLabel} </a>
                    </ui:fragment>
                    
                    <!-- FULLTEXT (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextAvailableForPage}">
                        <a
                            id="textPage"
                            class="label label-default"
                            title="#{msg.downloadPageFulltext}"
                            target="_blank"
                            href="#{activeDocumentBean.viewManager.fulltextUrl}"> #{msg.FULLEXT} </a>
                    </ui:fragment>

                    <!-- PDF (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessPermissionPdf}">
                        <a
                            id="pdfPage"
                            class="label label-default"
                            title="#{msg.pdfDownloadCurrentPage}"
                            href="#{activeDocumentBean.viewManager.pdfPageDownloadLink}"> #{msg.pdfDownload} </a>
                    </ui:fragment>

                    <!-- JPEG -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessForJs}">
                        <a
                            id="jpeg"
                            class="label label-default"
                            title="#{msg.imageLinkDesc}"
                            target="_blank"
                            href="#{activeDocumentBean.viewManager.currentImageUrl}"> #{msg.imageLink} </a>
                    </ui:fragment>
                </div>
            </div>
        </ui:fragment>
    
        <script>
        
            var clipboard = new ClipboardJS( '[data-copy="iiif-manifest"]' );
            clipboard.on("success", function(e) {
               var $trigger = $(e.trigger);
               var tooltipText = "#{msg.iiif_CopyUrlDone}";
               if(!$trigger.attr('data-original-original-title')) {
                   $trigger.attr('data-original-original-title', $trigger.attr('data-original-title'));
               }
               $trigger
               .attr('data-original-title', tooltipText)
               .tooltip('fixTitle')
               .tooltip('show')
               .attr('data-original-title', $trigger.attr('data-original-original-title'))
               .tooltip('fixTitle');
    
            })
        
        	var downloadModalConfig = {
                downloadBtn: $( ".download-modal-widget" ),
                path: "#{navigationHelper.applicationUrl}",
                iiifPath: "#{configurationBean.iiifApiUrl}",
                userEmail: $( "#userEmail" ).val(),
                useReCaptcha: #{configurationBean.useReCaptcha},
                reCaptchaSiteKey: "#{configurationBean.reCaptchaSiteKey}",
                messages: {
                    downloadInfo: {
                        text: "#{msg.downloadInfoText}",
                        title: "#{msg.downloadInfoTitle}",
                        part: "#{msg.downloadInfoPart}",
                        fileSize: "#{msg.downloadInfoFileSize}"
                    },
                    reCaptchaText: "#{msg.downloadReCaptchaText}",
                    rcInvalid: "#{msg.downloadRcInvalid}",
                    rcValid: "#{msg.downloadRcValid}",
                    eMailText: "#{msg.downloadEMailText}",
                    eMailTextLoggedIn: "#{msg.downloadEMailTextLoggedIn}",
                    eMail: "#{msg.downloadEmail}",
                    closeBtn: "#{msg.downloadCloseModal}",
                    saveBtn: "#{msg.downloadGenerateFile}",
                }
            };
            viewerJS.downloadModal.init( downloadModalConfig );
        </script>
    
    </composite:implementation>
</ui:composition>
