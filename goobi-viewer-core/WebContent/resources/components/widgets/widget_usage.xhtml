<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:viewerComponent="http://xmlns.jcp.org/jsf/composite/components">
    
    <composite:interface />

    <composite:implementation>
        <ui:fragment rendered="#{configurationBean.displayWidgetUsage}">
            <div id="widgetUsage" class="widget widget-usage">
                <h3>#{msg.usage}</h3>

                <!-- LICENSE TEXT -->
                <p id="licenseText" class="widget-usage__license-text">
                    <viewerComponent:metadata metadata="#{activeDocumentBean.viewManager.usageWidgetAccessCondition}" displayLabel="false" />
                </p>

                <!-- WORK -->
                <h4 id="titleWork" class="widget-usage__subtitle">#{msg.Werk}</h4>
                
                <!-- WORK DOWNLOADS -->
                <div class="widget-usage__work-downloads">
                    <!-- METS/LIDO -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'METS'}">
                        <a id="lidomets" class="label label-default widget-usage__work-download-lido-mets" title="#{msg.metadata_dl_mets}" target="_blank" href="#{activeDocumentBean.viewManager.metsResolverUrl}">
                            #{msg.downloadMetsButtonLabel} </a>
                    </ui:fragment>
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.activeDocument.sourceDocFormat == 'LIDO'}">
                        <a id="lidomets" class="label label-default widget-usage__work-download-lido-mets" title="#{msg.metadata_dl_lido}" target="_blank" href="#{activeDocumentBean.viewManager.lidoResolverUrl}">
                            #{msg.downloadLidoButtonLabel} </a>
                    </ui:fragment>
    
                    <!-- ALTO (WORK) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForWork}">
                        <a id="alto" class="label label-default widget-usage__work-download-alto" title="#{msg.metadata_dl_alto_work}" href="#{activeDocumentBean.viewManager.altoUrlForAllPages}">
                            #{msg.downloadAltoWorkButtonLabel} </a>
                    </ui:fragment>
    
                    <!-- FULLTEXT (WORK) -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.belowFulltextThreshold}">
                        <a id="textWork" class="label label-default widget-usage__work-download-fulltext" title="#{msg.downloadWorkFulltext}" href="#{activeDocumentBean.viewManager.fulltextUrlForAllPages}">
                            #{msg.FULLEXT} </a>
                    </ui:fragment>
    
                    <!-- PDF (WORK) -->
                    <ui:fragment rendered="#{!activeDocumentBean.viewManager.filesOnly and activeDocumentBean.viewManager.hasPages and activeDocumentBean.accessPermissionPdf}">
                        <ui:fragment rendered="#{!configurationBean.generatePdfInTaskManager}">
                            <a id="pdfWork" class="label label-default widget-usage__work-download-pdf" href="#{activeDocumentBean.viewManager.pdfDownloadLink}" title="#{msg.metadata_dl_pdf}" target="_blank">
                                #{msg.pdfDownload}</a>
                        </ui:fragment>
                        <ui:fragment rendered="#{configurationBean.generatePdfInTaskManager}">
                            <a id="pdfWork" class="label label-default widget-usage__work-download-pdf download-modal-widget" href="#" data-type="pdf" data-title="#{activeDocumentBean.titleBarLabel}" data-id=""
                                data-pi="#{activeDocumentBean.viewManager.pi}" title="#{msg.pdfDownload}"> #{msg.pdfDownload}</a>
    
                        </ui:fragment>
                    </ui:fragment>
    
                    <!-- EPUB -->
                    <ui:fragment rendered="#{activeDocumentBean.accessPermissionEpub}">
                        <a href="#" class="label label-default widget-usage__work-download-epub download-modal-widget" data-type="epub" data-title="#{activeDocumentBean.titleBarLabel}" data-id=""
                            data-pi="#{activeDocumentBean.viewManager.pi}" title="#{msg.epubDownload}"> #{msg.epub} </a>
                    </ui:fragment>
    
                    <!-- IIIF MANIFEST -->
                    <a id="iiifManifest" class="label label-default widget-usage__work-download-iiif" data-copy="iiif-manifest" data-clipboard-text="#{imageDelivery.iiifManifest}" title="#{msg.iiif_copyUrl}">
                        #{msg.iiif} </a>
                </div>
                    
                <!-- PAGE -->
                <h4 id="titlePage" class="widget_usage__subtitle">#{msg.page}</h4>
                
                <!-- PAGE DOWNLOADS -->
                <div class="widget-usage__page-downloads">
                    <!-- ALTO (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.altoAvailableForPage}">
                        <a id="altoPage" class="label label-default widget-usage__page-download-alto" title="#{msg.metadata_dl_alto_page}" target="_blank" href="#{activeDocumentBean.viewManager.altoUrl}">
                            #{msg.downloadAltoPageButtonLabel} </a>
                    </ui:fragment>
    
                    <!-- FULLTEXT (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.fulltextAvailableForPage}">
                        <a id="textPage" class="label label-default widget-usage__page-download-fulltext" title="#{msg.downloadPageFulltext}" target="_blank" href="#{activeDocumentBean.viewManager.fulltextUrl}">
                            #{msg.FULLEXT} </a>
                    </ui:fragment>
    
                    <!-- PDF (PAGE) -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessPermissionPdf}">
                        <a id="pdfPage" class="label label-default widget-usage__page-download-pdf" title="#{msg.pdfDownloadCurrentPage}" href="#{activeDocumentBean.viewManager.pdfPageDownloadLink}">
                            #{msg.pdfDownload} </a>
                    </ui:fragment>
    
                    <!-- JPEG -->
                    <ui:fragment rendered="#{activeDocumentBean.viewManager.currentPage.accessForJs}">
                        <a id="jpeg" class="label label-default widget-usage__page-download-jpeg" title="#{msg.imageLinkDesc}" target="_blank" href="#{activeDocumentBean.viewManager.currentImageUrl}">
                            #{msg.imageLink} </a>
                    </ui:fragment>
                </div>
            </div>
            
            <script>        
                var clipboard = new ClipboardJS( '[data-copy="iiif-manifest"]' );
                
                clipboard.on("success", function(e) {
                   var $trigger = $(e.trigger);
                   var tooltipText = "#{msg.iiif_CopyUrlDone}";
                   if(!$trigger.attr('data-original-original-title')) {
                       $trigger.attr('data-original-original-title', $trigger.attr('data-original-title'));
                   }
                   $trigger
                   .attr('data-original-title', tooltipText)
                   .tooltip('fixTitle')
                   .tooltip('show')
                   .attr('data-original-title', $trigger.attr('data-original-original-title'))
                   .tooltip('fixTitle');
        
                })
            
            	var downloadModalConfig = {
                    downloadBtn: $( ".download-modal-widget" ),
                    path: "#{navigationHelper.applicationUrl}",
                    iiifPath: "#{configurationBean.iiifApiUrl}",
                    userEmail: $( "#userEmail" ).val(),
                    useReCaptcha: #{configurationBean.useReCaptcha},
                    reCaptchaSiteKey: "#{configurationBean.reCaptchaSiteKey}",
                    messages: {
                        downloadInfo: {
                            text: "#{msg.downloadInfoText}",
                            title: "#{msg.downloadInfoTitle}",
                            part: "#{msg.downloadInfoPart}",
                            fileSize: "#{msg.downloadInfoFileSize}"
                        },
                        reCaptchaText: "#{msg.downloadReCaptchaText}",
                        rcInvalid: "#{msg.downloadRcInvalid}",
                        rcValid: "#{msg.downloadRcValid}",
                        eMailText: "#{msg.downloadEMailText}",
                        eMailTextLoggedIn: "#{msg.downloadEMailTextLoggedIn}",
                        eMail: "#{msg.downloadEmail}",
                        closeBtn: "#{msg.downloadCloseModal}",
                        saveBtn: "#{msg.downloadGenerateFile}",
                    }
                };
                
                viewerJS.downloadModal.init( downloadModalConfig );
            </script>    
        </ui:fragment>
    </composite:implementation>
</ui:composition>
