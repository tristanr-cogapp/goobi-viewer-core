<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
    xmlns:composite="http://xmlns.jcp.org/jsf/composite">

    <composite:interface>
        <composite:attribute name="pageNummbers" required="false" default="true" />
        <composite:attribute name="pdfIcon" required="false" default="true" />
    </composite:interface>

    <composite:implementation>
		<ui:fragment rendered="#{configurationBean.sidebarTocVisible and !activeDocumentBean.viewManager.activeDocument.lidoRecord and (activeDocumentBean.toc.hasChildren() or configurationBean.displayEmptyTocInSidebar)}">
			<div id="widgetToc" class="widget widget-toc">
		    	<h:form id="widgetTocForm" prependId="false">                    
                    <!-- TITLE -->
                    <div class="widget-toc__title">
                        <h3>#{msg.sidebarTocAnchor}</h3>

                        <!-- EXPAND ALL -->
                        <ui:fragment rendered="#{configurationBean.sidebarTocTreeView and activeDocumentBean.toc.maxTocDepth > 0}">
                            <div class="widget-toc__title-expand">
                                <!-- LOADER -->
                                <div class="widget-toc__loader"></div>
                            
                                <!-- CLOSE -->
                                <h:commandLink styleClass="btn btn--clean" action="#{activeDocumentBean.toc.collapseAll}" title="#{msg.allClose}">
                                    <i class="fa fa-minus-square-o" aria-hidden="true"></i>
                                    <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                    <f:passThroughAttribute name="data-placement" value="top" />
                                    <f:ajax render="widgetTocForm" />
                                </h:commandLink>
                                <!-- OPEN -->
                                <h:commandLink styleClass="btn btn--clean" action="#{activeDocumentBean.toc.expandAll}" title="#{msg.allOpen}">
                                    <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                    <f:passThroughAttribute name="data-toggle" value="tooltip" />
                                    <f:passThroughAttribute name="data-placement" value="top" />
                                    <f:ajax render="widgetTocForm" />
                                </h:commandLink>
                            </div>
                        </ui:fragment>
                    </div>

                    <!-- ELEMENTS -->
                    <div class="widget-toc__elements">
                        <!-- OVERLAY -->
                        <div class="widget-toc__overlay"></div>                        
                    
                        <!-- TREE VIEW -->
		            	<ui:fragment rendered="#{configurationBean.sidebarTocTreeView}">
							<ul>
							    <ui:repeat var="group" value="#{activeDocumentBean.toc.groupNames}">
    								<ui:repeat var="tocElement" value="#{activeDocumentBean.toc.getTreeViewForGroup(group)}">
    									<ui:fragment rendered="#{tocElement.visible}">
    										<li class="widget-toc__element #{tocElement.hasChild == true ? 'parent' : 'child' } #{tocElement.iddoc == activeDocumentBean.viewManager.currentDocumentIddoc ? 'active' : ''}" data-iddoc="iddoc_#{tocElement.iddoc}" style="margin-left: #{tocElement.level * 15}px">
    											<ui:fragment rendered="#{tocElement.visible}">
    												<!-- EXPAND -->
    												<ui:fragment rendered="#{tocElement.hasChild == true}">
    													<div class="widget-toc__element-expand">
    														<h:commandLink styleClass="btn btn--clean" action="#{activeDocumentBean.setChildrenVisible(tocElement)}" rendered="#{tocElement.visible and !tocElement.expanded}">
																<i class="fa fa-plus-square-o" aria-hidden="true"></i>
																<f:ajax render="@form" />
    														</h:commandLink>
    														<h:commandLink styleClass="btn btn--clean" action="#{activeDocumentBean.setChildrenInvisible(tocElement)}" rendered="#{tocElement.visible and tocElement.expanded}">
    															<i class="fa fa-minus-square-o" aria-hidden="true"></i>
    															<f:ajax render="@form" />
    														</h:commandLink>
    													</div>
    												</ui:fragment>
    	
    												<!-- READINGMODE LINK -->
                                                    <ui:fragment rendered="#{navigationHelper.currentView == 'readingmode'}">
        												<div class="widget-toc__element-link #{configurationBean.sidebarTocPageNumbersVisible ? 'has-pagenumber' : ''} #{tocElement.iddoc == activeDocumentBean.viewManager.currentDocumentIddoc ? 'active' : ''}">
        													<h:outputLink 
        														rendered="#{tocElement.label != null and tocElement.visible}" 
        														title="#{tocElement.label}"
        														value="#{tocElement.getUrl('readingmode')}"
        														styleClass="#{tocElement.iddoc == activeDocumentBean.viewManager.currentDocumentIddoc ? 'active' : ''}">
        														#{tocElement.label}
        													</h:outputLink>
        												</div>
                                                    </ui:fragment>
                                                    
                                                    <!-- LINK -->
                                                    <ui:fragment rendered="#{navigationHelper.currentView != 'readingmode'}">
                                                        <div class="widget-toc__element-link #{configurationBean.sidebarTocPageNumbersVisible ? 'has-pagenumber' : ''} #{tocElement.iddoc == activeDocumentBean.viewManager.currentDocumentIddoc ? 'active' : ''}">
                                                            <h:outputLink 
                                                                rendered="#{tocElement.label != null and tocElement.visible}" 
                                                                title="#{tocElement.label}"
                                                                value="#{tocElement.url}">
                                                                #{tocElement.label}
                                                            </h:outputLink>
                                                        </div>
                                                    </ui:fragment>
    	
    												<!-- PAGE NUMBER -->
    												<ui:fragment rendered="#{configurationBean.sidebarTocPageNumbersVisible}">
    													<div class="widget-toc__element-pagenumber">#{tocElement.pageNoLabel}</div>
    												</ui:fragment>
    											</ui:fragment>
    										</li>
    									</ui:fragment>
    								</ui:repeat>
								</ui:repeat>
							</ul>
						</ui:fragment>	                
		
		                <!-- NON TREE VIEW -->
                        <ui:fragment rendered="#{!configurationBean.sidebarTocTreeView}">
							<ul>
								<ui:repeat var="group" value="#{activeDocumentBean.toc.groupNames}">
									<ui:repeat var="tocElement" value="#{activeDocumentBean.toc.getViewForGroup(group)}">
										<li class="widget-toc__element #{tocElement.hasChild == true ? 'parent' : 'child' }" data-logid="#{tocElement.logId}" style="margin-left: #{tocElement.level * 15}px">
											<!-- LINK -->
											<div class="widget-toc__element-link #{!configurationBean.sidebarTocTreeView ? 'non-tree-view' : ''} #{configurationBean.sidebarTocPageNumbersVisible ? 'has-pagenumber' : ''}">
												<h:outputLink rendered="#{tocElement.label != null}"
													title="#{tocElement.label}" value="#{tocElement.url}"
													styleClass="#{tocElement.iddoc == activeDocumentBean.viewManager.currentDocumentIddoc ? 'active' : ''}">
													<h:outputText value="#{tocElement.label}" />
												</h:outputLink>
											</div> 
                                            <!-- PAGE NUMBER --> 
                                            <ui:fragment rendered="#{configurationBean.sidebarTocPageNumbersVisible}">
												<div class="widget-toc__element-pagenumber">
													<h:outputText value="#{tocElement.pageNoLabel}" />
												</div>
											</ui:fragment>
										</li>
									</ui:repeat>
								</ui:repeat>
							</ul>
						</ui:fragment>
						
		                <script type="text/javascript">																			
							viewerJS.widgetToc.init();
		                </script>
		            </div>
			    </h:form>
		    </div>
	    </ui:fragment>
    </composite:implementation>
</ui:composition>
